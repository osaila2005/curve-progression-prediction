<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<body>
  <br />
  <table cellpadding="5" align="center">
  <tr>
    <td>
      <img src="http://127.0.0.1:8887/Drexel-logo.jpg" alt="Drexel Univeristy logo" width="100" height="100">
    </td>
    <td>
    <p align="center">
        <font size="6">Predicition of Final Cobb Angle in Adolescent Idiopathic Scoliosis</font>
        <font size="4"><br/> Ausilah Alfraihat, Amir Samdani, MD, <a  href="mailto:sb939@drexel.edu?Subject=Final%20Cobb%20Angle%20Prediction"> Sriram Balasubramanian,</a> PhD</font>
                           <br />
                          
    </p>
    </td>
      <td>
          <img src="http://127.0.0.1:8887/OBL_logo.jpg" alt="OBL logo" width="150" height="110">
      </td>
  </tr>
  </table>
  <hr />

  <p align="center">
    <font size="4">

	<p>
This Random Forest model predicts curve progression in Adolescent Idiopathic Scoliosis patients. The outcome is predicted in terms of the "Final Cobb angle". This model was developed using data from 193 patients with idiopathic scoliosis. The model was trained on data from 144 subjects and tested on data from 49 subjects. The expected prediction error is 4.6 ± 4.3 degrees. The patients were aged 12.7 ± 1.7 years (range 10-17.8) and had major Cobb angle of 48.9 ± 13.9°. All patients did not undergo surgery for spine curve correction.
	<p/>
	<p>
All data was obtained from a single center; the model’s performance on patients from other centers, or patients with features out of the range specified in the table below, is unpredictable. Please test the model using retrospective data from your own center. We hope to encourage the eventual use of machine learning prediction models such as this in clinical practice. We appreciate any feedback.
	<p/>
  <p>
If you use this model, please cite our paper:
  <p/>
    </font>
</p>
<title>Predicition of Final Cobb Angle in Adolescent Idiopathic Scoliosis</title>
<style>
table , th, td {
        border: 1px solid black;
        border-collapse: collapse;
        }

  .div1 {
  width: 350px;
  height: 25px;
  border: 2px solid rgb(0, 0, 0);
}
.result {
    margin: auto;
    width: 35%;
    border: 1px solid #ccc;
}
</style>
</head>
<body>


     <!-- Main Input For Receiving Query to our ML -->
    <form id="form" action="{{ url_for('predict')}}"  method="post" onsubmit="window.location.reload();">
      <p id="p0"></p>
        <span style="font-weight:bold;text-decoration:underline;">Please refer to the Features Description section below for more details</span>
<br>

<table style="width:58%"> 
  <tr>
    <th>Rank</th>
    <th>Features</th>
    <th>Values</th>
    <th>Range</th>
  </tr>
  
  <tr>
    <td>1</td>
    <td>Initial Cobb angle (°)</td>
    <td><input id="1" type="text" name="Cobb_Initial"  autocomplete="off" required="required"/></td>
    <td>[10.9 - 99.5]</td>
  </tr>

  <tr>
    <td>2</td>
    <td>Flexibility (%)</td>
    <td><input id="2" type="text" name="Flexibility" autocomplete="off" required="required"/></td>
    <td>[0.05 - 0.99]</td>
  </tr>

  <tr>
    <td>3</td>
    <td>Lumbar lordosis angle (°)</td>
    <td><input id="3" type="text" name="Lordosis" autocomplete="off" required="required"/></td>
    <td>[3.4 - 87.1]</td>
  </tr>

  <tr>
    <td>4</td>
    <td>Thoracic kyphosis angle (°)</td>
    <td><input id="4" type="text" name="Kyphosis" autocomplete="off" required="required"/></td>
    <td>[0 - 51.3]</td>
  </tr>

  <tr>
    <td>5</td>
    <td>Age at prediction (years)</td>
    <td><input id="5" type="text" name="Age_last" autocomplete="off" required="required"/></td>
    <td>[10.4 - 18.6]</td>
  </tr>

  <tr>
    <td>6</td>
    <td><label for="Num_Levels_Involved">Number of levels involved</label></td>
    <td>
      <select name="Num_Levels_Involved" id="6">
        <option value="-">-Select-</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>
    </td>
    <td>Select from drop-down list</td>
  </tr>

  <tr>
    <td>7</td>
    <td><label for="Risser_First_TP">Risser"+" stage at initial diagnosis</label></td>
    <td>
      <select name="Risser_First_TP" id="7">
        <option value="-">-Select-</option>
        <option value="-2">Open triradiate cartilage (0-)</option>
        <option value="-1">Close triradiate cartilage (0+)</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="0.75">3/4</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </td>
    <td>Select from drop-down list</td>
  </tr>

 



</table>
    <br>
    <br>
    <button type="button" onclick="f1();f2();f3();f4();f5();f6();f7();submitForm(event)" class="btn btn-primary btn-block btn-large">Predict</button>  
    
    <!--<button type="button" style="background-color: green;color: aliceblue" onclick="f1();f2();f3();f4();f5();f0();reset()">Predict</button>-->
    <input type="reset" value="Reset" style="background-color: crimson;color: aliceblue"/>
    <p id="p1"></p>
    <p id="p2"></p>
    <p id="p3"></p>
    <p id="p4"></p>
    <p id="p5"></p>
    <p id="p6"></p>
    <p id="p7"></p>

<div id="error1" style="color: #fa0000"></div>
<div id="error2" style="color: #fa0000"></div>
<div id="error3" style="color: #fa0000"></div>
<div id="error4" style="color: #fa0000"></div>
<div id="error5" style="color: #fa0000"></div>
<div id="error6" style="color: #fa0000"></div>
<div id="error7" style="color: #fa0000"></div>


<script type="text/javascript">

var e1=0;
var e2=0;
var e3=0;
var e4=0;
var e5=0;
var e6=0;
var e7=0;

function f1() {
  const message = document.getElementById("p1");
  message.innerHTML = "";
  let x = document.getElementById("1").value;

  try {
    
    if(x == "") throw "Initial Cobb angle value is empty";
    if(isNaN(x))  throw "Initial Cobb angle value is not a number";
    if(x < 10.99)  throw "Initial Cobb angle value is out of range";
    if(x > 99.5)   throw "Initial Cobb angle value is out of range";
    if( x>= 10.99 && x<= 99.5) throw " ";
  }
  catch(err) {
    e1=1;
    document.getElementById("error1").innerHTML = " " + err;
  }
}
function f2() {
  const message = document.getElementById("p2");
  message.innerHTML = "";
  let x = document.getElementById("2").value;
  try { 
    if(x == "")  throw "Flexibility (%) is empty";
    if(isNaN(x)) throw "Flexibility (%) is not a number";
    if(x < 0.05)  throw "Flexibility (%) is out of range";
    if(x > 0.99)  throw "Flexibility (%) is out of range";
    if(x >= 0.05 || x <= 0.99) throw " ";
  }
  catch(err) {
    e2=1
    document.getElementById("error2").innerHTML = "  " + err;
  }
}

function f3() {
  const message = document.getElementById("p3");
  message.innerHTML = "";
  let x = document.getElementById("3").value;
  try { 
    if(x == "")  throw "Lumbar lordosis angle (L1-L5) is empty";
    if(isNaN(x)) throw "Lumbar lordosis angle (L1-L5) is not a number";
    if(x < 3.4)  throw "Lumbar lordosis angle (L1-L5) is out of range";
    if(x > 87.1)   throw "Lumbar lordosis angle (L1-L5) is out of range";
    if(x >= 3.4 || x <= 87.1) throw " ";
  }
  catch(err) {
    e3=1
    document.getElementById("error3").innerHTML = " " + err;
  }
}

function f4() {
  const message = document.getElementById("p4");
  message.innerHTML = "";
  let x = document.getElementById("4").value;
  try { 
    if(x == "")  throw "Thoracic kyphosis angle (T2-T12) is empty";
    if(isNaN(x)) throw "Thoracic kyphosis angle (T2-T12) is not a number";
    x = Number(x);
    if(x < 0)  throw "Thoracic kyphosis angle (T2-T12) is out of range";
    if(x > 51.3)   throw "Thoracic kyphosis angle (T2-T12) is out of range";
    if(x >= 0 || x <= 51.3) throw " ";
  }
  catch(err) {
    e4=1
    document.getElementById("error4").innerHTML = " " + err;
  }
}

function f5() {
  const message = document.getElementById("p5");
  message.innerHTML = "";
  let x = document.getElementById("5").value;
  try { 
    if(x == "")  throw "Age at predicition (years) is empty";
    if(isNaN(x)) throw "Age at predicition (years) is not a number";
    x = Number(x);
    if(x < 10.4)  throw "Age at predicition (years) is out of range";
    if(x > 18.6)   throw "Age at predicition (years) is out of range";
    if(x >= 10.4 || x <= 18.6) throw " ";
  }
  catch(err) {
    e5=1
    document.getElementById("error5").innerHTML = " " + err;
  }
}

function f6() {
  const message = document.getElementById("p6");
  message.innerHTML = "";
  let x = document.getElementById("6").value;
  try { 
    if(x == "-")  throw "Number of levels involved is required";
    if(x != "-")  throw " ";
}
catch(err) {
    e6=1
    document.getElementById("error6").innerHTML = " " + err;
  }
}

function f7() {
  const message = document.getElementById("p7");
  message.innerHTML = "";
  let x = document.getElementById("7").value;
  try { 
    if(x == "-")  throw "Risser'+' stage is required";
    if(x != "-")  throw " ";
}
catch(err) {
    e7=1
    document.getElementById("error7").innerHTML = " " + err;
  }
}


function submitForm(){
  var originalvalue = document.getElementById("p1").value;
  let x1 = document.getElementById("1").value;
  let x2 = document.getElementById("2").value;
  let x3 = document.getElementById("3").value;
  let x4 = document.getElementById("4").value;
  let x5 = document.getElementById("5").value;
  let x6 = document.getElementById("6").value;
  let x7 = document.getElementById("7").value;
   
  if((e1 == 1 || e2 == 1 || e3 == 1 || e4 == 1 || e5 == 1 || e6 == 1 || e7 == 1) && ((x1<= 10.99 || x1>= 99.5) || (x2 <= 0.05 || x2 >= 0.99) || (x3 <= 3.4 || x3 >= 87.1) || (x4 <= 0 || x4 >= 51.3) || (x5 <= 10.4 || x5 >= 18.6) || (x6 == "-") || (x7 == "-")) )
  {
    event.preventDefault(); 
    e1=0;e2=0;e3=0;e4=0;e5=0;e6=0;e7=0;
  }
  else
  {
    document.getElementById("form").submit();
    
  }
}




</script>
<div class="div1">
  {{ prediction_text }}
</div>

</fieldset>
</form>


    <br>
   <h2>Features Description</h2>
  <br>

  <table style="width:80%">
    <tr>
      <th>Feature</th>
      <th>Description</th>
      <th>Radiographic Measurement</th>
    </tr>
    <tr>
      <td>Initial Cobb angle </td>
      <td>Cobb angle is the angle measured between the lines which are above the most tilted vertebrae superior to the apex and below the most tilted vertebrae inferior to the apex</td>
      <th><img src="http://127.0.0.1:8887/Initial_Cobb_Angle.jpg" alt="Initial_Cobb_Angle" width="200" height="200"></th>
    </tr>
    <tr>
      <td>Flexibility</td>
      <td>The flexibility is calculated as the percent change in cobb angle between the standing radiograph and the side bending radiograph</td>
      <th><img src="http://127.0.0.1:8887/Flexibility.jpg" alt="Flexibility" width="500" height="300"></th>
    </tr>
    <tr>
      <td>Lumbar lordosis and thoracic kyphosis angles</td>
      <td>Lordosis and Kyphosis angles are measured from lateral radiographs
       <p>Lordosis angle is the angle between the superior endplate of L1 and the inferior endplate of L5</p>
       <p>Kyphosis angle is the angle between the superior endplate of T2 and the inferior endplate of T12</p>
        </td>
      <th><img src="http://127.0.0.1:8887/Kyphosis_Lordosis.jpg" alt="Kyphosis_Lordosis"width="100" height="270"></th>
      <tr>
        <td>Age at prediction (years)</td>
        <td>Age of the patient at which the prediction is made </td>
        <th>NA</th>
      </tr>
    </tr>
    <tr>
      <td>Number of levels involved</td>
      <td>The number of vertebral levels involved in the major curve. In the figure on the right, seven levels are involved in the curve</td>
      <th><img src="http://127.0.0.1:8887/Initial_Cobb_Angle.jpg" alt="Num_Levels_Involved" width="200" height="200"></th>
    </tr>
    <tr>
      <td>Risser"+" stage at initial diagnosis</td>
      <td>
        <p>Risser + staging system is an eight-point system, describes the pattern of ossification of the iliac apophysis and subsequent fusion of the apophysis to the ilium.
        It combines the conventional Risser staging system with triradiate cartilage maturity assessment.</p>
        <p>The Risser+ system consists of grade:</p>
        <p>0-: open TRC</p>
        <p>0+: Closed TRC</p> 
        <p>Risser 1 :25% coverage</p> 
        <p>Risser 2: 50% coverage</p>
        <p>Risser 3: 75% coverage</p>
        <p>Risser ¾: 100% coverage</p>
        <p>Risser 4: Start of fusion</p>
        <p>Risser 5: complete fusion</p>
        <p>For further details, please refer to:</p> 
        <p><a href="https://link.springer.com/article/10.1007/s00586-018-5821-8" target="_blank">Troy, Michael J., Patricia E. Miller, Nigel Price, Vish Talwalkar, Fabio Zaina, Sabrina Donzelli, Stefano Negrini, and M. Timothy Hresko. "The “Risser+” grade: a new grading system to classify skeletal maturity in idiopathic scoliosis." European Spine Journal 28, no. 3 (2019): 559-566.
         </a></p>
        </td>
      <th><img src="http://127.0.0.1:8887/Risser.jpg" alt="Risser" width="600" height="350"></th>
    </tr>
  </table>
</body>
</html>